(function(j){var h=[],k=/^url\(["']?([^"'\)]*)["']?\);?$/i,l=/\.png$/i,g=j.browser.msie&&j.browser.version==6;function i(){j.each(h,function(){this.refresh(true)})}j(window).resize(i);j.Poshytip=function(a,b){this.$elm=j(a);this.opts=j.extend({},j.fn.poshytip.defaults,b);this.$tip=j(['<div class="',this.opts.className,'">','<div class="tip-inner tip-bg-image"></div>','<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"></div>',"</div>"].join("")).appendTo(document.body);this.$arrow=this.$tip.find("div.tip-arrow");this.$inner=this.$tip.find("div.tip-inner");this.disabled=false;this.content=null;this.init()};j.Poshytip.prototype={init:function(){h.push(this);var a=this.$elm.attr("title");this.$elm.data("title.poshytip",a!==undefined?a:null).data("poshytip",this);if(this.opts.showOn!="none"){this.$elm.bind({"mouseenter.poshytip":j.proxy(this.mouseenter,this),"mouseleave.poshytip":j.proxy(this.mouseleave,this)});switch(this.opts.showOn){case"hover":if(this.opts.alignTo=="cursor"){this.$elm.bind("mousemove.poshytip",j.proxy(this.mousemove,this))}if(this.opts.allowTipHover){this.$tip.hover(j.proxy(this.clearTimeouts,this),j.proxy(this.mouseleave,this))}break;case"focus":this.$elm.bind({"focus.poshytip":j.proxy(this.show,this),"blur.poshytip":j.proxy(this.hide,this)});break}}},mouseenter:function(a){if(this.disabled){return true}this.$elm.attr("title","");if(this.opts.showOn=="focus"){return true}this.clearTimeouts();this.showTimeout=setTimeout(j.proxy(this.show,this),this.opts.showTimeout)},mouseleave:function(b){if(this.disabled||this.asyncAnimating&&(this.$tip[0]===b.relatedTarget||jQuery.contains(this.$tip[0],b.relatedTarget))){return true}var a=this.$elm.data("title.poshytip");if(a!==null){this.$elm.attr("title",a)}if(this.opts.showOn=="focus"){return true}this.clearTimeouts();this.hideTimeout=setTimeout(j.proxy(this.hide,this),this.opts.hideTimeout)},mousemove:function(a){if(this.disabled){return true}this.eventX=a.pageX;this.eventY=a.pageY;if(this.opts.followCursor&&this.$tip.data("active")){this.calcPos();this.$tip.css({left:this.pos.l,top:this.pos.t});if(this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow}}},show:function(){if(this.disabled||this.$tip.data("active")){return}this.reset();this.update();this.display();if(this.opts.timeOnScreen){setTimeout(j.proxy(this.hide,this),this.opts.timeOnScreen)}},hide:function(){if(this.disabled||!this.$tip.data("active")){return}this.display(true)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",false);this.$inner.find("*").poshytip("hide");if(this.opts.fade){this.$tip.css("opacity",this.opacity)}this.$arrow[0].className="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left";this.asyncAnimating=false},update:function(b,a){if(this.disabled){return}var c=b!==undefined;if(c){if(!a){this.opts.content=b}if(!this.$tip.data("active")){return}}else{b=this.opts.content}var d=this,e=typeof b=="function"?b.call(this.$elm[0],function(f){d.update(f)}):b=="[title]"?this.$elm.data("title.poshytip"):b;if(this.content!==e){this.$inner.empty().append(e);this.content=e}this.refresh(c)},refresh:function(s){if(this.disabled){return}if(s){if(!this.$tip.data("active")){return}var f={left:this.$tip.css("left"),top:this.$tip.css("top")}}this.$tip.css({left:0,top:0}).appendTo(document.body);if(this.opacity===undefined){this.opacity=this.$tip.css("opacity")}var e=this.$tip.css("background-image").match(k),d=this.$arrow.css("background-image").match(k);if(e){var r=l.test(e[1]);if(g&&r){this.$tip.css("background-image","none");this.$inner.css({margin:0,border:0,padding:0});e=r=false}else{this.$tip.prepend('<table border="0" cellpadding="0" cellspacing="0"><tr><td class="tip-top tip-bg-image" colspan="2"><span></span></td><td class="tip-right tip-bg-image" rowspan="2"><span></span></td></tr><tr><td class="tip-left tip-bg-image" rowspan="2"><span></span></td><td></td></tr><tr><td class="tip-bottom tip-bg-image" colspan="2"><span></span></td></tr></table>').css({border:0,padding:0,"background-image":"none","background-color":"transparent"}).find(".tip-bg-image").css("background-image",'url("'+e[1]+'")').end().find("td").eq(3).append(this.$inner)}if(r&&!j.support.opacity){this.opts.fade=false}}if(d&&!j.support.opacity){if(g&&l.test(d[1])){d=false;this.$arrow.css("background-image","none")}this.opts.fade=false}var b=this.$tip.find("table");if(g){this.$tip[0].style.width="";b.width("auto").find("td").eq(3).width("auto");var c=this.$tip.width(),q=parseInt(this.$tip.css("min-width")),t=parseInt(this.$tip.css("max-width"));if(!isNaN(q)&&c<q){c=q}else{if(!isNaN(t)&&c>t){c=t}}this.$tip.add(b).width(c).eq(0).find("td").eq(3).width("100%")}else{if(b[0]){b.width("auto").find("td").eq(3).width("auto").end().end().width(document.defaultView&&document.defaultView.getComputedStyle&&parseFloat(document.defaultView.getComputedStyle(this.$tip[0],null).width)||this.$tip.width()).find("td").eq(3).width("100%")}}this.tipOuterW=this.$tip.outerWidth();this.tipOuterH=this.$tip.outerHeight();this.calcPos();if(d&&this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow;this.$arrow.css("visibility","inherit")}if(s){this.asyncAnimating=true;var a=this;this.$tip.css(f).animate({left:this.pos.l,top:this.pos.t},200,function(){a.asyncAnimating=false})}else{this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(f){var e=this.$tip.data("active");if(e&&!f||!e&&f){return}this.$tip.stop();if((this.opts.slide&&this.pos.arrow||this.opts.fade)&&(f&&this.opts.hideAniDuration||!f&&this.opts.showAniDuration)){var a={},b={};if(this.opts.slide&&this.pos.arrow){var c,n;if(this.pos.arrow=="bottom"||this.pos.arrow=="top"){c="top";n="bottom"}else{c="left";n="right"}var d=parseInt(this.$tip.css(c));a[c]=d+(f?0:(this.pos.arrow==n?-this.opts.slideOffset:this.opts.slideOffset));b[c]=d+(f?(this.pos.arrow==n?this.opts.slideOffset:-this.opts.slideOffset):0)+"px"}if(this.opts.fade){a.opacity=f?this.$tip.css("opacity"):0;b.opacity=f?0:this.opacity}this.$tip.css(a).animate(b,this.opts[f?"hideAniDuration":"showAniDuration"])}f?this.$tip.queue(j.proxy(this.reset,this)):this.$tip.css("visibility","inherit");this.$tip.data("active",!e)},disable:function(){this.reset();this.disabled=true},enable:function(){this.disabled=false},destroy:function(){this.reset();this.$tip.remove();delete this.$tip;this.content=null;this.$elm.unbind(".poshytip").removeData("title.poshytip").removeData("poshytip");h.splice(j.inArray(this,h),1)},clearTimeouts:function(){if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0}if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=0}},calcPos:function(){var d={l:0,t:0,arrow:""},u=j(window),r={l:u.scrollLeft(),t:u.scrollTop(),w:u.width(),h:u.height()},b,s,e,t,a,v;if(this.opts.alignTo=="cursor"){b=s=e=this.eventX;t=a=v=this.eventY}else{var c=this.$elm.offset(),f={l:c.left,t:c.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};b=f.l+(this.opts.alignX!="inner-right"?0:f.w);s=b+Math.floor(f.w/2);e=b+(this.opts.alignX!="inner-left"?f.w:0);t=f.t+(this.opts.alignY!="inner-bottom"?0:f.h);a=t+Math.floor(f.h/2);v=t+(this.opts.alignY!="inner-top"?f.h:0)}switch(this.opts.alignX){case"right":case"inner-left":d.l=e+this.opts.offsetX;if(d.l+this.tipOuterW>r.l+r.w){d.l=r.l+r.w-this.tipOuterW}if(this.opts.alignX=="right"||this.opts.alignY=="center"){d.arrow="left"}break;case"center":d.l=s-Math.floor(this.tipOuterW/2);if(d.l+this.tipOuterW>r.l+r.w){d.l=r.l+r.w-this.tipOuterW}else{if(d.l<r.l){d.l=r.l}}break;default:d.l=b-this.tipOuterW-this.opts.offsetX;if(d.l<r.l){d.l=r.l}if(this.opts.alignX=="left"||this.opts.alignY=="center"){d.arrow="right"}}switch(this.opts.alignY){case"bottom":case"inner-top":d.t=v+this.opts.offsetY;if(!d.arrow||this.opts.alignTo=="cursor"){d.arrow="top"}if(d.t+this.tipOuterH>r.t+r.h){d.t=t-this.tipOuterH-this.opts.offsetY;if(d.arrow=="top"){d.arrow="bottom"}}break;case"center":d.t=a-Math.floor(this.tipOuterH/2);if(d.t+this.tipOuterH>r.t+r.h){d.t=r.t+r.h-this.tipOuterH}else{if(d.t<r.t){d.t=r.t}}break;default:d.t=t-this.tipOuterH-this.opts.offsetY;if(!d.arrow||this.opts.alignTo=="cursor"){d.arrow="bottom"}if(d.t<r.t){d.t=v+this.opts.offsetY;if(d.arrow=="bottom"){d.arrow="top"}}}this.pos=d}};j.fn.poshytip=function(d){if(typeof d=="string"){var e=arguments,a=d;Array.prototype.shift.call(e);if(a=="destroy"){this.die("mouseenter.poshytip").die("focus.poshytip")}return this.each(function(){var f=j(this).data("poshytip");if(f&&f[a]){f[a].apply(f,e)}})}var c=j.extend({},j.fn.poshytip.defaults,d);if(!j("#poshytip-css-"+c.className)[0]){j(['<style id="poshytip-css-',c.className,'" type="text/css">',"div.",c.className,"{visibility:hidden;position:absolute;top:0;left:0;}","div.",c.className," table, div.",c.className," td{margin:0;font-family:inherit;font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;}","div.",c.className," td.tip-bg-image span{display:block;font:1px/1px sans-serif;height:",c.bgImageFrameSize,"px;width:",c.bgImageFrameSize,"px;overflow:hidden;}","div.",c.className," td.tip-right{background-position:100% 0;}","div.",c.className," td.tip-bottom{background-position:100% 100%;}","div.",c.className," td.tip-left{background-position:0 100%;}","div.",c.className," div.tip-inner{background-position:-",c.bgImageFrameSize,"px -",c.bgImageFrameSize,"px;}","div.",c.className," div.tip-arrow{visibility:hidden;position:absolute;overflow:hidden;font:1px/1px sans-serif;}","</style>"].join("")).appendTo("head")}if(c.liveEvents&&c.showOn!="none"){var b=j.extend({},c,{liveEvents:false});switch(c.showOn){case"hover":this.live("mouseenter.poshytip",function(){var f=j(this);if(!f.data("poshytip")){f.poshytip(b).poshytip("mouseenter")}});break;case"focus":this.live("focus.poshytip",function(){var f=j(this);if(!f.data("poshytip")){f.poshytip(b).poshytip("show")}});break}return this}return this.each(function(){new j.Poshytip(this,c)})};j.fn.poshytip.defaults={content:"[title]",className:"tip-yellow",bgImageFrameSize:10,showTimeout:500,hideTimeout:100,timeOnScreen:0,showOn:"hover",liveEvents:false,alignTo:"cursor",alignX:"right",alignY:"top",offsetX:-22,offsetY:18,allowTipHover:true,followCursor:false,fade:true,slide:true,slideOffset:8,showAniDuration:300,hideAniDuration:300}})(jQuery);
